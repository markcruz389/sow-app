FROM node:25-alpine

# set working dir
WORKDIR /api

# install pnpm via corepack (Node 20+ includes corepack)
RUN npm install -g pnpm

# copy package files first to leverage layer caching
COPY package*.json pnpm-lock.yaml* ./

# install dependencies (dev deps included) with pnpm
RUN pnpm install --frozen-lockfile --silent

# copy app source
COPY . .

# Generate Prisma Client
RUN pnpm prisma generate --generator client

EXPOSE 3000

ENTRYPOINT ["./docker-entrypoint.dev.sh"]
